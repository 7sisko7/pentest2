var snapnames = {
	init : function() {	
		if(!isMobile()){
			var change_mode=true;
		}else{
			var change_mode=false;
		}
			
		
		jQuery( window ).on("resize", function() {
			//these variables determine the width of the viewport in a way that matches the CSS media queries
			var w=window;
			var d=document;
			var e=d.documentElement;
			var g=d.getElementsByTagName('body')[0];
			var viewWidth=w.innerWidth||e.clientWidth||g.clientWidth;
			
			if(!isMobile()){		
				jQuery( ".resMenu" ).css('display', "block");
				//jQuery( ".searchPanelControls" ).css('display', "block");
				change_mode=true;
			}else{
				if(change_mode){
					jQuery( ".resMenu" ).css('display', "none");
					//jQuery( ".searchPanelControls" ).css('display', "none");
					change_mode=false;
				}
			}
			
			if (viewWidth > 999){
				jQuery("#dismissMenu").hide();
				jQuery(".resMenu").removeClass("resMenu_appear");
			}
		});
		
		jQuery( ".i_mobile_menu, #dismissMenu" ).on("click", function() {
			var $resMenu = jQuery(".resMenu");
			var menuWidth = parseInt($resMenu.css("width"));
			var menuLeft = $resMenu.css("left");
			var menuDisplay = $resMenu.css("display");
			
			//this is the mobile menu in its expanded/visible state, on click move it to the left by its own width and then hide it
			if (menuLeft == "0px" && menuDisplay == "block"){
				$resMenu.animate(
						{left: menuWidth * -1}, 400, function(){
							$resMenu.hide();
						}
					);				
			}
			//this is the mobile menu when it is not visible
			else {
				//if the menu is positioned onscreen move it offscreen before showing it and animating it on
				if (menuLeft == "0px" || menuLeft == "auto"){
					$resMenu.css("left", menuWidth * -1);
				}
				
				$resMenu.show();
				$resMenu.animate(
						{left: 0}, 400
					);				
			}
			//toggles the dismissMenu element that covers up all non-menu items and dismisses the menu on click
			jQuery("#dismissMenu").toggle();
		});
		
		jQuery( ".i_search_category" ).on("click", function() {
			jQuery(".searchPanelControls").toggle("slide");						
		});
		
		/* Tooltip hovering */
		jQuery( ".info_block" ).on("mouseenter mouseleave", function() {
			jQuery( this ).children( ".tooltip" ).toggleClass( "invisible block" );
		});	
		
		//////////////- Desktop behavior -//////////////
		
		//////////////- tier1 behavior -//////////////
		jQuery( ".tier1" ).on("mouseenter", function() {	
			if(!isMobile()){
				show_menu(this,".submenu");				
			}
		});
		
		jQuery( ".tier1" ).on("mouseleave", function() {	
			if(!isMobile()){
				hide_menu(this,".submenu");
			}			
		});	
		
		//////////////- tier2 behavior -//////////////
		jQuery( ".tier2_expand" ).on("mouseenter", function() {	
			if(!isMobile()){
				show_menu(this,".tier2_submenu");		
			}
		});
		
		jQuery( ".tier2_expand" ).on("mouseleave", function() {		
			if(!isMobile()){
				hide_menu(this,".tier2_submenu");
			}			
		});			
		
		//////////////- Mobile behavior -//////////////
		
		//////////////- tier1 behavior -//////////////
		jQuery( ".tier1" ).on("click", function() {
			if(isMobile()){				
				if(jQuery( this ).children( ".submenu" ).hasClass("invisible")){
					//closes all the tier1 trees
					jQuery( "ul" ).children( ".tier1" ).each(function(index, value) { 
						hide_menu(this,".submenu");
					});
					//opens the tier1 selected
					show_menu(this,".submenu");
				}else{
					//closes the tier1 selected
					hide_menu(this,".submenu");
				}	
			}			
		});					
				
		//////////////- tier2 behavior -//////////////
		jQuery( ".tier2_expand" ).on("click", function() {			
			if(isMobile()){	
				if(jQuery( this ).children( ".tier2_submenu" ).hasClass("invisible")){
					//opens the tier2_expand selected
					show_menu(this,".tier2_submenu");
				}else{
					//closes the tier2_expand selected
					hide_menu(this,".tier2_submenu");
				}	
				parent_trigger(this,".tier1");
			}
			
		});	
		
		jQuery( ".tier2" ).on("click", function() {	
			if(isMobile()){	
				parent_trigger(this,".tier1");
			}
		});	
		
		//////////////- tier3 behavior -//////////////
		jQuery( ".tier3" ).on("click", function() {	
			if(isMobile()){	
				parent_trigger(this,".tier2_expand");
			}
		});
		
		//////////////- common behavior -//////////////
		function isMobile(){
			return jQuery( ".desktop" ).css('display') == 'none';
		}
		
		function show_menu(element, child){
			jQuery( element ).children( child ).addClass( "block" ).removeClass( "invisible" );	
		}
		
		function hide_menu(element, child){
			jQuery( element ).children( child ).addClass( "invisible" ).removeClass( "block" );	
		}
		
		function parent_trigger(element, parent){
			jQuery( element ).closest(parent).trigger( "click" );
		}
	}		
};

jQuery(document).ready(snapnames.init);
	